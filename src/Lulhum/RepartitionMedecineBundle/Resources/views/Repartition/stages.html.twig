{# src/Lulhum/RepartitionMedecineBundle/Resources/views/Repartition/stages.html.twig #}

{% extends "LulhumRepartitionMedecineBundle::layout.html.twig" %}

{% block title %}
  Choix des stages - {{ parent() }}
{% endblock %}

{% block lulhumrepartitionmedecine_body %}

	<div class="panel panel-default" >
		<div class="panel-heading" >
			<ul class="nav nav-tabs">
				<li role="presentation" {% if type == 'proposals' %}class="active"{% endif %}>
					<a href="{{ path('lulhum_repartitionmedecine_stages_proposals') }}">Propositions</a>
				</li>
				<li role="presentation" {% if type == 'pending' %}class="active"{% endif %}>
					<a href="{{ path('lulhum_repartitionmedecine_stages_pending') }}">Mes Demandes</a>
				</li>
				<li role="presentation" {% if type == 'accepted' %}class="active"{% endif %}>
					<a href="#">Stages Acceptés</a>
				</li>
				<li role="presentation" {% if type == 'history' %}class="active"{% endif %}>
					<a href="#">Historique</a>
				</li>
			</ul>
		</div>
		<div class="panel-body" >
			{% for key, messages in app.session.flashbag.all() %}
				{% for message in messages %}
					<div class="alert alert-{{ key }} alert-dismissible">
						{{ message }}
						<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					</div>
				{% endfor %}
			{% endfor %}
			{% if proposals|length == 0 %}
				<div class="alert alert-info" role="alert" >
					{% if type == 'proposals' %}
						Aucune proposition disponible
					{% elseif type == 'pending' %}
						Aucune demande en cours
					{% endif %}
				</div>
			{% else %}
				{% for proposal in proposals %}
					<div class="panel panel-default" >
						<div class="panel-heading" >{{ proposal.name }}</div>
						<div class="panel-body" >
							Période: {{ proposal.period.description }}<br/>
							Places:
							{% set taked = proposal.stages.count %}
							{% if proposal.hasRequirementType('maxPlaces') %}
								{% set max = proposal.getRequirementsByType('maxPlaces')[0].params %}
								<span class="label label-{% if taked > max %}danger{% elseif taked == max %}warning{% else %}success{% endif %}" >
									{{ taked  }}/{{ max }}
								</span>
							{% else %}
								<span class="label label-success" >{{ taked }}/&infin;</span>
							{% endif %}
						</div>
						<div class="panel-footer" >
							{% if type == 'proposals' %}
								<a href="{{ path('lulhum_repartitionmedecine_stages_suscribe', {'id': proposal.id}) }}" class="btn btn-primary" >
									S'inscrire au stage
								</a>
							{% elseif type == 'pending' and not proposal.locked() %}
								<a href="{{ path('lulhum_repartitionmedecine_stages_unsuscribe', {'id': proposal.id}) }}" class="btn btn-danger" >
									Annuler l'inscription
								</a>
							{% endif %}
						</div>
					</div>
				{% endfor %}
			{% endif %}
		</div>
	</div>

{% endblock %}
